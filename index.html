<body>
  <div class="container">
    <h1>Spreadsheet Transformer</h1>

    <div class="button-row">
      <button onclick="toggleInstructions()">Instructions</button>
      <button onclick="toggleFixedDataRange()">My Fixed Data Range / Columns</button>
      <button onclick="toggleTripletDataRange()">Triplet Data Range</button>
    </div>

    <!-- Instructions Panel -->
    <div id="instructions" style="display:none;">
      <h3>Instructions</h3>
      <ol>
        <li>Click <strong>Upload</strong> to choose an Excel or CSV file.</li>
        <li>After uploading, preview the data in the table below.</li>
        <li>Click <strong>My Fixed Data Range / Columns</strong> to specify columns that should remain unchanged.</li>
        <li>Click <strong>Triplet Data Range</strong> to specify columns containing Brand, Sub Category, and SKU.</li>
        <li>Click <strong>Process</strong> to process the data according to your specifications.</li>
        <li>Click <strong>Download Excel</strong> to export the result as an Excel file.</li>
      </ol>
    </div>

    <!-- File Upload -->
    <input type="file" id="upload" accept=".csv, .xlsx, .xls" />
    <button id="processBtn" disabled onclick="processData()">Process</button>
    <button id="downloadBtn" disabled onclick="downloadExcel()">Download Excel</button>
    <p id="status"></p>

    <!-- Data Preview Table -->
    <h3>Data Preview</h3>
    <table id="preview"></table>

    <!-- Fixed Data Range Panel -->
    <div id="fixedDataRange" style="display:none;">
      <h3>My Fixed Data Range / Columns</h3>
      <p>After previewing, enter the columns that should remain fixed (e.g., A, B, C):</p>
      <input type="text" id="fixedColumns" placeholder="Enter fixed columns" />
      <button onclick="applyFixedColumns()">Apply</button>
    </div>

    <!-- Triplet Data Range Panel -->
    <div id="tripletDataRange" style="display:none;">
      <h3>Triplet Data Range</h3>
      <p>After previewing, enter the columns that contain Brand, Sub Category, and SKU (e.g., D:F, G:I):</p>
      <input type="text" id="tripletColumns" placeholder="Enter triplet columns" />
      <button onclick="applyTripletColumns()">Apply</button>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    let data; // Store uploaded data
    let fixedColumns = [];
    let tripletColumns = [];

    // Toggle Instructions Panel
    function toggleInstructions() {
      const instr = document.getElementById("instructions");
      instr.style.display = instr.style.display === "none" ? "block" : "none";
    }

    // Toggle Fixed Data Range Panel
    function toggleFixedDataRange() {
      const fixedRange = document.getElementById("fixedDataRange");
      fixedRange.style.display = fixedRange.style.display === "none" ? "block" : "none";
    }

    // Toggle Triplet Data Range Panel
    function toggleTripletDataRange() {
      const tripletRange = document.getElementById("tripletDataRange");
      tripletRange.style.display = tripletRange.style.display === "none" ? "block" : "none";
    }

    // Handle file upload
    document.getElementById("upload").addEventListener("change", handleFileUpload);

    function handleFileUpload(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        const fileData = e.target.result;
        const wb = XLSX.read(fileData, {type: 'binary'});

        // Assuming the first sheet is the relevant one
        const ws = wb.Sheets[wb.SheetNames[0]];
        data = XLSX.utils.sheet_to_json(ws, {header: 1});
        
        // Preview the data
        previewData();
        document.getElementById("processBtn").disabled = false;
      };
      
      reader.readAsBinaryString(file);
    }

    // Preview data in a table
    function previewData() {
      const table = document.getElementById("preview");
      table.innerHTML = ""; // Clear previous preview
      
      data.forEach((row, i) => {
        const tr = document.createElement("tr");
        row.forEach(cell => {
          const td = document.createElement("td");
          td.textContent = cell;
          tr.appendChild(td);
        });
        table.appendChild(tr);
      });
    }

    // Apply Fixed Data Range (capturing user input)
    function applyFixedColumns() {
      const input = document.getElementById("fixedColumns").value;
      fixedColumns = input.split(',').map(col => col.trim());
      console.log("Fixed columns applied:", fixedColumns);
    }

    // Apply Triplet Data Range (capturing user input)
    function applyTripletColumns() {
      const input = document.getElementById("tripletColumns").value;
      tripletColumns = input.split(',').map(col => col.trim());
      console.log("Triplet columns applied:", tripletColumns);
    }

    // Process Data (dummy function for now)
    function processData() {
      console.log("Processing data with fixed columns:", fixedColumns);
      console.log("Processing data with triplet columns:", tripletColumns);
      
      // You can implement logic here to process the data based on fixed and triplet columns.
      // For example, fixing columns, transforming triplet data, etc.

      // Enable the download button after processing
      document.getElementById("downloadBtn").disabled = false;
    }

    // Download the processed data as Excel
    function downloadExcel() {
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Processed Data");
      XLSX.writeFile(wb, "processed_data.xlsx");
    }
  </script>
</body>
